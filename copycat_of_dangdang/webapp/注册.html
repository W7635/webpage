<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>注册</title>
    <link rel="stylesheet" href="CSS/注册.css">
    <style>
        body {
            margin: 0;
            text-align: center; /* 使行内元素（如 img）水平居中 */
            overflow: scroll;
            font-family: "SimSun", "宋体", serif;
        }
        .error-message {
            color: red;
            margin-top: 10px;
        }
    </style>
</head>
<body>
<img src="picture/logo.png" class="img_logo">
<img src="picture/登录页面图片.png" class="img_denglu">
<div class="container">
    <a href="登录.jsp" class="back-arrow">&#8678;</a>
    <h2>立即注册</h2>
    <input type="text" placeholder="手机号" id="phone">
    <input type="password" placeholder="设置密码" id="password">
    <div class="code-container">
        <input type="text" placeholder="用户类型：1-管理员，2-普通会员" id="user_type">
    </div>
    <div class="agreement-container">
        <input type="checkbox" id="agreement">
        <label for="agreement">同意 <a href="#">用户协议</a>、<a href="#">隐私政策</a></label>
    </div>
    <button id="register" disabled>同意并注册</button>
    <div id="error-message" class="error-message"></div>
    <script>
    const agreementCheckbox = document.getElementById('agreement');
    const registerButton = document.getElementById('register');
    const errorMessage = document.getElementById('error-message');
    const phoneInput = document.getElementById('phone');
    const passwordInput = document.getElementById('password');
    const userTypeInput = document.getElementById('user_type');

    // 启用注册按钮
    agreementCheckbox.addEventListener('change', function() {
        registerButton.disabled = !this.checked;
    });

    registerButton.addEventListener('click', function () {
        const phone = phoneInput.value.trim();
        const password = passwordInput.value.trim();
        const userType = userTypeInput.value.trim();

        // 基本表单验证
        if (!phone || !password || !userType) {
            errorMessage.textContent = '请填写所有必填字段';
            return;
        }

        // 验证手机号格式
        const phonePattern = /^1[3-9]\d{9}$/;
        if (!phonePattern.test(phone)) {
            errorMessage.textContent = '请输入有效的手机号';
            return;
        }

        // 验证用户类型
        if (!['1', '2'].includes(userType)) {
            errorMessage.textContent = '用户类型只能是1或2';
            return;
        }

        // 创建 FormData 对象
        const formData = new FormData();
        formData.append('phone', phone);
        formData.append('password', password);
        formData.append('user_type', userType);

        // 发送注册请求
        fetch('/keshe/RegisterServlet', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('HTTP错误! status: ' + response.status);
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                alert('注册成功，请登录');
                window.location.href = '登录.html';
            } else {
                errorMessage.textContent = data.message || '注册失败，请重试';
            }
        })
        .catch(error => {
            console.error('请求异常:', error);
            errorMessage.textContent = '网络错误，请稍后重试';
        });
    });
    </script>
</div>
</body>
</html>